# Component Definition: Total Equity
# Stockholders' equity / shareholders' equity

component_id: total_equity
display_name: "Total Equity"
description: "Residual interest in assets after deducting liabilities. Net worth of the company."

category: balance_sheet
subcategory: equity

characteristics:
  balance_type: credit
  period_type: instant
  is_monetary: true
  is_abstract: false
  data_type: monetary

matching_rules:
  label_rules:
    # Highest priority: Exact matches
    - patterns:
        - "Stockholders' Equity"
        - "Total Equity"
        - "Total Stockholders' Equity"
        - "Shareholders' Equity"
      match_type: exact
      case_sensitive: false
      weight: 20

    # High weight for contains patterns
    - patterns:
        - "total equity"
        - "stockholders' equity"
        - "shareholders' equity"
        - "total stockholders' equity"
        - "equity, total"
      match_type: contains
      case_sensitive: false
      weight: 12

    # IFRS terminology
    - patterns:
        - "Equity"
        - "Total Equity"
        - "Equity Attributable to Owners"
      match_type: exact
      case_sensitive: false
      weight: 20

    - patterns:
        - "equity attributable"
      match_type: contains
      weight: 8

    # Prefer total equity INCLUDING NCI over parent-only equity.
    # This is the correct concept for balance sheet identity (A=L+E).
    # Without this, parent-only StockholdersEquity wins on label scoring
    # because its shorter label matches exact patterns better.
    - patterns:
        - "including portion attributable to noncontrolling"
        - "including noncontrolling"
      match_type: contains
      case_sensitive: false
      weight: 20

  local_name_rules:
    # TOTAL equity (including NCI) gets higher weight - this is the
    # correct concept for A=L+E identity. Without this preference,
    # StockholdersEquity (parent-only, excluding NCI) ties and wins
    # the tiebreaker, causing A=L+E to fail by the NCI amount.
    - patterns:
        - "StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest"
      match_type: exact
      weight: 20

    # Parent-only equity and IFRS equivalents
    - patterns:
        - "StockholdersEquity"
        - "Equity"
        - "EquityAttributableToOwnersOfParent"
      match_type: exact
      weight: 15

    - patterns:
        - "StockholdersEquity"
        - "ShareholdersEquity"
        - "Equity"
      match_type: contains
      weight: 10

  hierarchy_rules:
    - rule_type: depth_level
      pattern: "1"
      weight: 5

  calculation_rules:
    - rule_type: has_children
      patterns:
        - "*CommonStock*"
        - "*RetainedEarnings*"
        - "*AdditionalPaidIn*"
        - "*Treasury*"
      min_matches: 2
      weight: 10

  definition_rules:
    - keywords:
        - "residual"
        - "stockholders"
        - "shareholders"
        - "net worth"
        - "equity"
      all_required: false
      weight: 4

scoring:
  min_score: 20
  confidence_levels:
    high: 35
    medium: 27
    low: 20
  tiebreaker: highest_in_hierarchy
  reject_if:
    - condition: "Is abstract concept"
      pattern: "abstract=true"
    # NOTE: NoncontrollingInterest rejected by min_score (no label/name match)
    # Do NOT reject "noncontrolling" substring - it blocks the valid concept
    # StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest
    - condition: "Is common stock only"
      pattern: "name~commonstock"
    - condition: "Is retained earnings only"
      pattern: "name~retainedearnings"
    - condition: "Is additional paid-in"
      pattern: "name~additionalpaidin"
    - condition: "Is treasury stock"
      pattern: "name~treasury"
    - condition: "Is accumulated OCI"
      pattern: "name~accumulatedother"
    # Reject cash flow adjustment concepts
    - condition: "Is cash flow adjustment"
      pattern: "name~adjustmentsfor"
    - condition: "Is increase/decrease item"
      pattern: "name~increasedecrease"

    - condition: "Is text block"
      pattern: "name~textblock"
    - condition: "Is schedule"
      pattern: "name~schedule"

composition:
  is_composite: false

validation:
  expected_sign: positive  # Usually positive, can be negative for troubled companies
  required_for:
    - debt_to_equity
    - equity_ratio
    - roe
    - book_value_per_share
